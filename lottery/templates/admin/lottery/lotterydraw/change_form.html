    <!-- Path: lottery/templates/admin/lottery/lotterydraw/change_form.html -->
    {% extends "admin/change_form.html" %}
    {% load static %}
    {% load i18n admin_urls %}
    {% load form_extras %}

    {% block extrahead %}
        {{ block.super }}
        <link rel="stylesheet" type="text/css" href="{% static 'admin/css/lottery_admin.css' %}">
    {% endblock %}

    {% block content %}
        <div class="lottery-header">
            {% if original %}
                Lottery Result - {{ original.full_name }}
            {% else %}
                Lottery Result Entry System
            {% endif %}
        </div>

        <!-- Show existing draw information if editing -->
        {% if original %}
        <div class="draw-info">
            <div class="draw-info-item">
                <div class="draw-info-label">Lottery Type</div>
                <div class="draw-info-value">{{ original.lottery_type.name }}</div>
            </div>
            <div class="draw-info-item">
                <div class="draw-info-label">Draw Code</div>
                <div class="draw-info-value">{{ original.draw_code }}</div>
            </div>
            <div class="draw-info-item">
                <div class="draw-info-label">Draw Date</div>
                <div class="draw-info-value">{{ original.draw_date|date:"M d, Y" }}</div>
            </div>
            <div class="draw-info-item">
                <div class="draw-info-label">Status</div>
                <div class="draw-info-value">
                    {% if original.result_declared %}
                        <span style="color: #28a745;">✅ Declared</span>
                    {% else %}
                        <span style="color: #ffc107;">⏳ Pending</span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Lottery Preview Container -->
        <div id="lottery-preview-container" class="lottery-preview">
            {% if original %}
                <!-- First Prize -->
                {% if original.first_prize %}
                <div class="prize-container">
                    <div class="prize-title">1st Prize</div>
                    <div class="prize-amount">₹ {{ original.first_prize.amount|floatformat:"0" }}/-</div>
                    <div class="prize-ticket">{{ original.first_prize.ticket_number }}</div>
                    <div class="prize-place">{{ original.first_prize.place }}</div>
                </div>
                {% endif %}
                
                <!-- Consolation Prizes -->
                {% if original.consolation_prizes.all %}
                <div class="prize-container">
                    <div class="prize-title">Consolation Prize</div>
                    <div class="prize-amount">₹ {{ original.consolation_prizes.first.amount|floatformat:"0" }}/-</div>
                    <table class="consolation-table">
                        <tbody>
                            <tr>
                                {% for prize in original.consolation_prizes.all %}
                                    <td>{{ prize.ticket_number }}</td>
                                    {% if forloop.counter|divisibleby:2 and not forloop.last %}
                                        </tr><tr>
                                    {% endif %}
                                {% endfor %}
                            </tr>
                        </tbody>
                    </table>
                </div>
                {% endif %}
                
                <!-- Second Prize -->
                {% if original.second_prize %}
                <div class="prize-container">
                    <div class="prize-title">2nd Prize</div>
                    <div class="prize-amount">₹ {{ original.second_prize.amount|floatformat:"0" }}/-</div>
                    <div class="prize-ticket">{{ original.second_prize.ticket_number }}</div>
                    <div class="prize-place">{{ original.second_prize.place }}</div>
                </div>
                {% endif %}
                
                <!-- Third Prize -->
                {% if original.third_prize %}
                <div class="prize-container">
                    <div class="prize-title">3rd Prize</div>
                    <div class="prize-amount">₹ {{ original.third_prize.amount|floatformat:"0" }}/-</div>
                    <div class="prize-ticket">{{ original.third_prize.ticket_number }}</div>
                    <div class="prize-place">{{ original.third_prize.place }}</div>
                </div>
                {% endif %}
                
                <!-- Fourth Prize -->
                {% if original.fourth_prize %}
                <div class="prize-container">
                    <div class="prize-title">4th Prize</div>
                    <div class="prize-amount">₹ {{ original.fourth_prize.amount|floatformat:"0" }}/-</div>
                    <div class="prize-ticket">{{ original.fourth_prize.ticket_number }}</div>
                    <div class="prize-place">{{ original.fourth_prize.place }}</div>
                </div>
                {% endif %}
                
                <!-- Fifth Prize -->
                {% if original.fifth_prizes.all %}
                <div class="prize-container">
                    <div class="prize-title">5th Prize</div>
                    <div class="prize-amount">₹ {{ original.fifth_prizes.first.amount|floatformat:"0" }}/-</div>
                    <table class="consolation-table">
                        <tbody>
                            {% for prize in original.fifth_prizes.all %}
                                <tr>
                                    <td>{{ prize.ticket_number }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
                
                <!-- Sixth to Tenth Prizes -->
                {% for prize_level in "sixth,seventh,eighth,ninth,tenth"|split:"," %}
                    {% with prizes=original|get_prizes:prize_level %}
                        {% if prizes %}
                        <div class="prize-container">
                            <div class="prize-title">{{ prize_level|title }} Prize</div>
                            <div class="prize-amount">₹ {{ prizes.first.amount|floatformat:"0" }}/-</div>
                            <table class="minor-prize-table">
                                <tbody>
                                    <tr>
                                        {% for prize in prizes %}
                                            <td>{{ prize.number }}</td>
                                            {% if forloop.counter|divisibleby:4 and not forloop.last %}
                                                </tr><tr>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        {% endif %}
                    {% endwith %}
                {% endfor %}
            {% endif %}
        </div>
        
        <form {% if has_file_field %}enctype="multipart/form-data" {% endif %}action="{{ form_url }}" method="post" id="{{ opts.model_name }}_form" novalidate>
            {% csrf_token %}
            
<div class="form-section">
    <div class="section-title">Lottery Draw Information</div>
    <div class="form-content">
        <div class="lottery-form-row">
            <div class="form-group">
                <label for="{{ form.lottery_type.id_for_label }}">{{ form.lottery_type.label }}</label>
                <div class="input-with-actions">
                    <select name="{{ form.lottery_type.name }}" id="{{ form.lottery_type.id_for_label }}" class="form-control">
                        <option value="">---------</option>
                        {% for choice in form.lottery_type.field.choices %}
                            <option value="{{ choice.0 }}" {% if form.lottery_type.value == choice.0 %}selected{% endif %}>
                                {{ choice.1 }}
                            </option>
                        {% endfor %}
                    </select>
                    <div class="field-actions">
                        {% if form.lottery_type.value %}
                        <a href="{% url 'admin:lottery_lotterytype_change' form.lottery_type.value %}" 
                           class="action-btn edit-btn" title="Edit selected lottery type">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </a>
                        {% else %}
                        <a href="#" class="action-btn edit-btn" title="Edit selected lottery type" style="display:none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </a>
                        {% endif %}
                        <a href="{% url 'admin:lottery_lotterytype_add' %}" 
                           class="action-btn add-btn" title="Add new lottery type">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                        </a>
                        <a href="{% url 'admin:lottery_lotterytype_changelist' %}" 
                           class="action-btn view-btn" title="View all lottery types">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                        </a>
                    </div>
                </div>
                {% if form.lottery_type.errors %}
                    <div class="error-messages">
                        {% for error in form.lottery_type.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="form-group">
                <label for="{{ form.draw_number.id_for_label }}">{{ form.draw_number.label }}</label>
                <input type="text" name="{{ form.draw_number.name }}" id="{{ form.draw_number.id_for_label }}" 
                       class="form-control" value="{{ form.draw_number.value|default:'' }}" placeholder="Enter draw number">
                {% if form.draw_number.errors %}
                    <div class="error-messages">
                        {% for error in form.draw_number.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="lottery-form-row">
            <div class="form-group">
                <label for="{{ form.draw_date.id_for_label }}">{{ form.draw_date.label }}</label>
                <div class="date-input-wrapper">
                    <input type="date" name="{{ form.draw_date.name }}" id="{{ form.draw_date.id_for_label }}" 
                           class="form-control" value="{{ form.draw_date.value|default:'' }}">
                    <button type="button" class="today-btn" onclick="setToday('{{ form.draw_date.id_for_label }}')">
                        Today
                    </button>
                    <button type="button" class="calendar-btn" onclick="showCalendar('{{ form.draw_date.id_for_label }}')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                    </button>
                </div>
                <div class="help-text">Note: You are 5.5 hours ahead of server time.</div>
                {% if form.draw_date.errors %}
                    <div class="error-messages">
                        {% for error in form.draw_date.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="form-group">
                <label for="{{ form.result_declared.id_for_label }}">{{ form.result_declared.label }}</label>
                <div class="checkbox-wrapper">
                    <input type="checkbox" name="{{ form.result_declared.name }}" id="{{ form.result_declared.id_for_label }}" 
                           class="form-control checkbox-input" {% if form.result_declared.value %}checked{% endif %}>
                    <label for="{{ form.result_declared.id_for_label }}" class="checkbox-label-text">
                        Mark as declared
                    </label>
                </div>
                {% if form.result_declared.errors %}
                    <div class="error-messages">
                        {% for error in form.result_declared.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Updated First Prize Section -->
<div class="prize-section">
    <div class="prize-header">
        <span>1st Prize</span>
    </div>
    <div class="prize-content">
        <!-- Editable Amount Field -->
        <div class="form-group">
            <label for="id_firstprize-0-amount">Amount (₹)</label>
            <input type="number" name="firstprize-0-amount" id="id_firstprize-0-amount"
                class="form-control" step="0.01"
                value="{% if original.first_prize %}{{ original.first_prize.amount }}{% endif %}">
        </div>

        <div class="lottery-form-row">
            <div class="form-group">
                <label for="id_firstprize-0-ticket_number">Ticket Number</label>
                <input type="text" name="firstprize-0-ticket_number" id="id_firstprize-0-ticket_number" 
                    class="form-control ticket-number" maxlength="20" required
                    value="{% if original.first_prize %}{{ original.first_prize.ticket_number }}{% endif %}">
            </div>
            <div class="form-group">
                <label for="id_firstprize-0-place">Place</label>
                <input type="text" name="firstprize-0-place" id="id_firstprize-0-place" 
                    class="form-control place" maxlength="100"
                    value="{% if original.first_prize %}{{ original.first_prize.place }}{% endif %}">
            </div>
        </div>
    </div>
</div>

            
            <!-- Consolation Prizes with Toggle -->
            <div class="prize-section">
                <div class="prize-header">
                    <span>Consolation Prize</span>
                    <div class="toggle-container">
                        <span class="toggle-label">Normal</span>
                        <div class="toggle-switch" onclick="toggleEntryMode('consolation')">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Bulk</span>
                    </div>
                </div>
                <div class="prize-content">
                    <!-- Normal Entry Mode -->
                    <div id="consolation-normal" class="entry-mode active">
                        <div class="consolation-note">
                            <strong>Manual Entry Mode</strong>
                            Enter each consolation prize ticket number and amount individually.
                        </div>
                        <div class="normal-entry">
                            <div class="entry-item" id="consolation-entry-0">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Prize Amount (₹)</label>
                                        <input type="number" name="consolation_amount_0" class="form-control" 
                                            value="{% if original.consolation_prizes.first %}{{ original.consolation_prizes.first.amount }}{% endif %}" step="1">
                                    </div>
                                    <div class="form-group">
                                        <label>Ticket Number</label>
                                        <input type="text" name="consolation_ticket_0" class="form-control ticket-number" maxlength="20"
                                            value="{% if original.consolation_prizes.first %}{{ original.consolation_prizes.first.ticket_number }}{% endif %}">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-entry-btn" onclick="addEntry('consolation')">+ Add Another Entry</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Entry Mode -->
                    <div id="consolation-bulk" class="entry-mode bulk-entry">
                        <div class="consolation-note">
                            <strong>Auto-Generated from First Prize</strong>
                            These prizes will be automatically created using the first prize number with different series (RA, RB, RC, etc.).
                        </div>
                        <div class="form-group">
                            <label for="consolation_bulk_amount">Prize Amount (₹)</label>
                            <input type="number" name="consolation_bulk_amount" id="consolation_bulk_amount" 
                                class="form-control" value="{% if original.consolation_prizes.first %}{{ original.consolation_prizes.first.amount }}{% endif %}" step="1">
                        </div>
                        <div class="form-group">
                            <label>Auto-Generate Options</label>
                            <div class="auto-generate-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="auto_generate_consolation" checked> 
                                    Auto-generate from First Prize
                                </label>
                                <div class="help-text">If checked, consolation prizes will be generated automatically using first prize number with series prefixes (RA, RB, RC, RD, RE, RF, RG, RH, RJ, RK)</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Manual Bulk Entry (Optional)</label>
                            <textarea name="consolation_bulk_results" class="form-control" rows="6" 
                                    placeholder="Format: TICKET_NUMBER&#10;RX123456&#10;RY789012&#10;RZ345678"></textarea>
                            <div class="help-text">Enter one ticket number per line. This will override auto-generation if provided.</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Second Prize -->
            <div class="prize-section">
                <div class="prize-header">
                    <span>2nd Prize</span>
                </div>
                <div class="prize-content">
                    <div class="form-group">
                        <label for="id_secondprize-0-amount">Prize Amount (₹)</label>
                        <input type="number" name="secondprize-0-amount" id="id_secondprize-0-amount"
                            class="form-control" step="0.01"
                            value="{% if original.second_prize %}{{ original.second_prize.amount }}{% endif %}">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="id_secondprize-0-ticket_number">Ticket Number</label>
                            <input type="text" name="secondprize-0-ticket_number" id="id_secondprize-0-ticket_number" 
                                class="form-control ticket-number" maxlength="20" required
                                value="{% if original.second_prize %}{{ original.second_prize.ticket_number }}{% endif %}">
                        </div>
                        <div class="form-group">
                            <label for="id_secondprize-0-place">Place</label>
                            <input type="text" name="secondprize-0-place" id="id_secondprize-0-place" 
                                class="form-control place" maxlength="100"
                                value="{% if original.second_prize %}{{ original.second_prize.place }}{% endif %}">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Third Prize with Toggle -->
            <div class="prize-section">
                <div class="prize-header">
                    <span>3rd Prize</span>
                    <div class="toggle-container">
                        <span class="toggle-label">Normal</span>
                        <div class="toggle-switch" onclick="toggleEntryMode('third')">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Bulk</span>
                    </div>
                </div>
                <div class="prize-content">
                    <!-- Normal Entry Mode -->
                    <div id="third-normal" class="entry-mode active">
                        <div class="normal-entry">
                            <div class="entry-item" id="third-entry-0">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Prize Amount (₹)</label>
                                        <input type="number" name="third_amount_0" class="form-control" 
                                            value="{% if original.third_prize %}{{ original.third_prize.amount }}{% endif %}" step="1">
                                    </div>
                                    <div class="form-group">
                                        <label>Ticket Number</label>
                                        <input type="text" name="third_ticket_0" class="form-control ticket-number" maxlength="20"
                                            value="{% if original.third_prize %}{{ original.third_prize.ticket_number }}{% endif %}">
                                    </div>
                                </div>
                                <div class="form-row single">
                                    <div class="form-group">
                                        <label>Place</label>
                                        <input type="text" name="third_place_0" class="form-control place" maxlength="100"
                                            value="{% if original.third_prize %}{{ original.third_prize.place }}{% endif %}">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-entry-btn" onclick="addEntry('third')">+ Add Another Entry</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Entry Mode -->
                    <div id="third-bulk" class="entry-mode bulk-entry">
                        <div class="form-group">
                            <label>Prize Amount (₹)</label>
                            <input type="number" name="third_bulk_amount" class="form-control" step="1">
                        </div>
                        <div class="form-group">
                            <label>Bulk Results</label>
                            <textarea name="third_bulk_results" class="form-control" rows="6" 
                                    placeholder="Format: TICKET_NUMBER PLACE&#10;RX123456 GURUVAYOOR&#10;RY789012 THIRUVANANTHAPURAM"></textarea>
                            <div class="help-text">Enter one result per line. Format: TICKET_NUMBER PLACE</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Fourth Prize with Toggle -->
            <div class="prize-section">
                <div class="prize-header">
                    <span>4th Prize</span>
                    <div class="toggle-container">
                        <span class="toggle-label">Normal</span>
                        <div class="toggle-switch" onclick="toggleEntryMode('fourth')">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Bulk</span>
                    </div>
                </div>
                <div class="prize-content">
                    <!-- Normal Entry Mode -->
                    <div id="fourth-normal" class="entry-mode active">
                        <div class="normal-entry">
                            <div class="entry-item" id="fourth-entry-0">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Prize Amount (₹)</label>
                                        <input type="number" name="fourth_amount_0" class="form-control" 
                                            value="{% if original.fourth_prize %}{{ original.fourth_prize.amount }}{% endif %}" step="1">
                                    </div>
                                    <div class="form-group">
                                        <label>Ticket Number</label>
                                        <input type="text" name="fourth_ticket_0" class="form-control ticket-number" maxlength="20"
                                            value="{% if original.fourth_prize %}{{ original.fourth_prize.ticket_number }}{% endif %}">
                                    </div>
                                </div>
                                <div class="form-row single">
                                    <div class="form-group">
                                        <label>Place</label>
                                        <input type="text" name="fourth_place_0" class="form-control place" maxlength="100"
                                            value="{% if original.fourth_prize %}{{ original.fourth_prize.place }}{% endif %}">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-entry-btn" onclick="addEntry('fourth')">+ Add Another Entry</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Entry Mode -->
                    <div id="fourth-bulk" class="entry-mode bulk-entry">
                        <div class="form-group">
                            <label>Prize Amount (₹)</label>
                            <input type="number" name="fourth_bulk_amount" class="form-control" step="1">
                        </div>
                        <div class="form-group">
                            <label>Bulk Results</label>
                            <textarea name="fourth_bulk_results" class="form-control" rows="6" 
                                    placeholder="Format: TICKET_NUMBER PLACE&#10;RX123456 GURUVAYOOR&#10;RY789012 THIRUVANANTHAPURAM"></textarea>
                            <div class="help-text">Enter one result per line. Format: TICKET_NUMBER PLACE</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Fifth Prize with Toggle -->
            <div class="prize-section">
                <div class="prize-header">
                    <span>5th Prize</span>
                    <div class="toggle-container">
                        <span class="toggle-label">Normal</span>
                        <div class="toggle-switch" onclick="toggleEntryMode('fifth')">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Bulk</span>
                    </div>
                </div>
                <div class="prize-content">
                    <!-- Normal Entry Mode -->
                    <div id="fifth-normal" class="entry-mode active">
                        <div class="normal-entry">
                            <div class="entry-item" id="fifth-entry-0">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Prize Amount (₹)</label>
                                        <input type="number" name="fifth_amount_0" class="form-control" step="1">
                                    </div>
                                    <div class="form-group">
                                        <label>Ticket Number</label>
                                        <input type="text" name="fifth_ticket_0" class="form-control ticket-number" maxlength="20">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-entry-btn" onclick="addEntry('fifth')">+ Add Another Entry</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Entry Mode -->
                    <div id="fifth-bulk" class="entry-mode bulk-entry">
                        <div class="form-group">
                            <label>Prize Amount (₹)</label>
                            <input type="number" name="fifth_bulk_amount" class="form-control" step="1">
                        </div>
                        <div class="form-group">
                            <label>Bulk Results</label>
                            <textarea name="fifth_bulk_results" class="form-control" rows="6" 
                                    placeholder="Format: TICKET_NUMBER&#10;RX123456&#10;RY789012"></textarea>
                            <div class="help-text">Enter one ticket number per line</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sixth Prize with Toggle -->
            <div class="prize-section">
                <div class="prize-header">
                    <span>6th Prize</span>
                    <div class="toggle-container">
                        <span class="toggle-label">Normal</span>
                        <div class="toggle-switch" onclick="toggleEntryMode('sixth')">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Bulk</span>
                    </div>
                </div>
                <div class="prize-content">
                    <!-- Normal Entry Mode -->
                    <div id="sixth-normal" class="entry-mode active">
                        <div class="normal-entry">
                            <div class="entry-item" id="sixth-entry-0">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Prize Amount (₹)</label>
                                        <input type="number" name="sixth_amount_0" class="form-control" step="1">
                                    </div>
                                    <div class="form-group">
                                        <label>Number</label>
                                        <input type="text" name="sixth_ticket_0" class="form-control ticket-number" maxlength="4">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-entry-btn" onclick="addEntry('sixth')">+ Add Another Entry</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Entry Mode -->
                    <div id="sixth-bulk" class="entry-mode bulk-entry">
                        <div class="form-group">
                            <label>Prize Amount (₹)</label>
                            <input type="number" name="sixth_bulk_amount" class="form-control" step="1">
                        </div>
                        <div class="form-group">
                            <label>Bulk Numbers</label>
                            <textarea name="sixth_bulk_results" class="form-control" rows="6" 
                                    placeholder="Format: NUMBER&#10;1234&#10;5678&#10;9012"></textarea>
                            <div class="help-text">Enter one 4-digit number per line</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Seventh Prize with Toggle -->
            <div class="prize-section">
                <div class="prize-header">
                    <span>7th Prize</span>
                    <div class="toggle-container">
                        <span class="toggle-label">Normal</span>
                        <div class="toggle-switch" onclick="toggleEntryMode('seventh')">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Bulk</span>
                    </div>
                </div>
                <div class="prize-content">
                    <!-- Normal Entry Mode -->
                    <div id="seventh-normal" class="entry-mode active">
                        <div class="normal-entry">
                            <div class="entry-item" id="seventh-entry-0">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Prize Amount (₹)</label>
                                        <input type="number" name="seventh_amount_0" class="form-control" step="1">
                                    </div>
                                    <div class="form-group">
                                        <label>Number</label>
                                        <input type="text" name="seventh_ticket_0" class="form-control ticket-number" maxlength="4">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-entry-btn" onclick="addEntry('seventh')">+ Add Another Entry</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Entry Mode -->
                    <div id="seventh-bulk" class="entry-mode bulk-entry">
                        <div class="form-group">
                            <label>Prize Amount (₹)</label>
                            <input type="number" name="seventh_bulk_amount" class="form-control" step="1">
                        </div>
                        <div class="form-group">
                            <label>Bulk Numbers</label>
                            <textarea name="seventh_bulk_results" class="form-control" rows="6" 
                                    placeholder="Format: NUMBER&#10;1234&#10;5678&#10;9012"></textarea>
                            <div class="help-text">Enter one 4-digit number per line</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Eighth Prize with Toggle -->
            <div class="prize-section">
                <div class="prize-header">
                    <span>8th Prize</span>
                    <div class="toggle-container">
                        <span class="toggle-label">Normal</span>
                        <div class="toggle-switch" onclick="toggleEntryMode('eighth')">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Bulk</span>
                    </div>
                </div>
                <div class="prize-content">
                    <!-- Normal Entry Mode -->
                    <div id="eighth-normal" class="entry-mode active">
                        <div class="normal-entry">
                            <div class="entry-item" id="eighth-entry-0">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Prize Amount (₹)</label>
                                        <input type="number" name="eighth_amount_0" class="form-control" step="1">
                                    </div>
                                    <div class="form-group">
                                        <label>Number</label>
                                        <input type="text" name="eighth_ticket_0" class="form-control ticket-number" maxlength="4">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-entry-btn" onclick="addEntry('eighth')">+ Add Another Entry</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Entry Mode -->
                    <div id="eighth-bulk" class="entry-mode bulk-entry">
                        <div class="form-group">
                            <label>Prize Amount (₹)</label>
                            <input type="number" name="eighth_bulk_amount" class="form-control" step="1">
                        </div>
                        <div class="form-group">
                            <label>Bulk Numbers</label>
                            <textarea name="eighth_bulk_results" class="form-control" rows="6" 
                                    placeholder="Format: NUMBER&#10;1234&#10;5678&#10;9012"></textarea>
                            <div class="help-text">Enter one 4-digit number per line</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ninth Prize with Toggle -->
            <div class="prize-section">
                <div class="prize-header">
                    <span>9th Prize</span>
                    <div class="toggle-container">
                        <span class="toggle-label">Normal</span>
                        <div class="toggle-switch" onclick="toggleEntryMode('ninth')">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Bulk</span>
                    </div>
                </div>
                <div class="prize-content">
                    <!-- Normal Entry Mode -->
                    <div id="ninth-normal" class="entry-mode active">
                        <div class="normal-entry">
                            <div class="entry-item" id="ninth-entry-0">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Prize Amount (₹)</label>
                                        <input type="number" name="ninth_amount_0" class="form-control" step="1">
                                    </div>
                                    <div class="form-group">
                                        <label>Number</label>
                                        <input type="text" name="ninth_ticket_0" class="form-control ticket-number" maxlength="4">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-entry-btn" onclick="addEntry('ninth')">+ Add Another Entry</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Entry Mode -->
                    <div id="ninth-bulk" class="entry-mode bulk-entry">
                        <div class="form-group">
                            <label>Prize Amount (₹)</label>
                            <input type="number" name="ninth_bulk_amount" class="form-control" step="1">
                        </div>
                        <div class="form-group">
                            <label>Bulk Numbers</label>
                            <textarea name="ninth_bulk_results" class="form-control" rows="6" 
                                    placeholder="Format: NUMBER&#10;1234&#10;5678&#10;9012"></textarea>
                            <div class="help-text">Enter one 4-digit number per line</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tenth Prize with Toggle -->
            <div class="prize-section">
                <div class="prize-header">
                    <span>10th Prize</span>
                    <div class="toggle-container">
                        <span class="toggle-label">Normal</span>
                        <div class="toggle-switch" onclick="toggleEntryMode('tenth')">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Bulk</span>
                    </div>
                </div>
                <div class="prize-content">
                    <!-- Normal Entry Mode -->
                    <div id="tenth-normal" class="entry-mode active">
                        <div class="normal-entry">
                            <div class="entry-item" id="tenth-entry-0">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Prize Amount (₹)</label>
                                        <input type="number" name="tenth_amount_0" class="form-control" step="1">
                                    </div>
                                    <div class="form-group">
                                        <label>Number</label>
                                        <input type="text" name="tenth_ticket_0" class="form-control ticket-number" maxlength="4">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-entry-btn" onclick="addEntry('tenth')">+ Add Another Entry</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Entry Mode -->
                    <div id="tenth-bulk" class="entry-mode bulk-entry">
                        <div class="form-group">
                            <label>Prize Amount (₹)</label>
                            <input type="number" name="tenth_bulk_amount" class="form-control" step="1">
                        </div>
                        <div class="form-group">
                            <label>Bulk Numbers</label>
                            <textarea name="tenth_bulk_results" class="form-control" rows="6" 
                                    placeholder="Format: NUMBER&#10;1234&#10;5678&#10;9012"></textarea>
                            <div class="help-text">Enter one 4-digit number per line</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Fixed Bottom Action Bar -->
            <div class="bottom-action-bar">
                <button type="button" class="preview-toggle-btn" onclick="togglePreview()">
                    <span id="preview-btn-text">Show Preview</span>
                </button>
                <input type="submit" value="{% if original %}Save Changes{% else %}Save Lottery Results{% endif %}" class="btn-primary" name="_save">
                {% if original %}
                    <a href="{% url opts|admin_urlname:'delete' original.pk|admin_urlquote %}" class="deletelink">Delete</a>
                {% endif %}
            </div>
        </form>

        <!-- Pass Django variables to JavaScript -->
        <script type="application/json" id="django-data">
            {
                "isEditMode": {% if original %}true{% else %}false{% endif %},
                "modelName": "{{ opts.model_name }}"
            }
        </script>

        <script>
            // Get Django data
            const djangoData = JSON.parse(document.getElementById('django-data').textContent);

            let entryCounters = {
                third: 1,
                fourth: 1,
                fifth: 1,
                sixth: 1,
                seventh: 1,
                eighth: 1,
                ninth: 1,
                tenth: 1
            };

            function toggleEntryMode(prize) {
                const toggleSwitch = document.querySelector(`#content .prize-section:has(#${prize}-normal) .toggle-switch`);
                const normalMode = document.getElementById(`${prize}-normal`);
                const bulkMode = document.getElementById(`${prize}-bulk`);
                
                toggleSwitch.classList.toggle('active');
                
                if (toggleSwitch.classList.contains('active')) {
                    normalMode.classList.remove('active');
                    bulkMode.classList.add('active');
                } else {
                    bulkMode.classList.remove('active');
                    normalMode.classList.add('active');
                }
            }

            function addEntry(prize) {
                const container = document.querySelector(`#${prize}-normal .normal-entry`);
                const entryCount = entryCounters[prize];
                
                const newEntry = document.createElement('div');
                newEntry.className = 'entry-item';
                newEntry.id = `${prize}-entry-${entryCount}`;
                
                const hasPlace = ['third', 'fourth'].includes(prize);
                const fieldLabel = ['sixth', 'seventh', 'eighth', 'ninth', 'tenth'].includes(prize) ? 'Number' : 'Ticket Number';
                const maxLength = ['sixth', 'seventh', 'eighth', 'ninth', 'tenth'].includes(prize) ? '4' : '20';
                
                let entryHTML = `
                    <button type="button" class="remove-entry-btn" onclick="removeEntry('${prize}-entry-${entryCount}')">×</button>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Prize Amount (₹)</label>
                            <input type="number" name="${prize}_amount_${entryCount}" class="form-control" step="1">
                        </div>
                        <div class="form-group">
                            <label>${fieldLabel}</label>
                            <input type="text" name="${prize}_ticket_${entryCount}" class="form-control ticket-number" maxlength="${maxLength}">
                        </div>
                    </div>
                `;
                
                if (hasPlace) {
                    entryHTML += `
                        <div class="form-row single">
                            <div class="form-group">
                                <label>Place</label>
                                <input type="text" name="${prize}_place_${entryCount}" class="form-control place" maxlength="100">
                            </div>
                        </div>
                    `;
                }
                
                newEntry.innerHTML = entryHTML;
                
                container.insertBefore(newEntry, container.querySelector('.add-entry-btn'));
                entryCounters[prize]++;
            }

            function removeEntry(entryId) {
                document.getElementById(entryId).remove();
            }

            function togglePreview() {
                const previewContainer = document.getElementById('lottery-preview-container');
                const buttonText = document.getElementById('preview-btn-text');
                
                if (previewContainer.classList.contains('show')) {
                    previewContainer.classList.remove('show');
                    buttonText.textContent = 'Show Preview';
                } else {
                    previewContainer.classList.add('show');
                    buttonText.textContent = 'Hide Preview';
                }
            }

            // Auto-format ticket numbers and places
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('ticket-number')) {
                    e.target.value = e.target.value.toUpperCase();
                }
                if (e.target.classList.contains('place')) {
                    e.target.value = e.target.value.toUpperCase();
                }
            });

            // Form validation before submit
            document.addEventListener('DOMContentLoaded', function() {
                const form = document.getElementById(djangoData.modelName + '_form');
                if (form) {
                    form.addEventListener('submit', function(e) {
                        // Basic validation
                        const firstPrizeTicket = document.getElementById('id_firstprize-0-ticket_number');
                        if (firstPrizeTicket && !firstPrizeTicket.value.trim()) {
                            alert('Please enter the First Prize ticket number');
                            e.preventDefault();
                            firstPrizeTicket.focus();
                            return false;
                        }
                        
                        return true;
                    });
                }

                // Auto-show preview for existing records
                const previewContainer = document.getElementById('lottery-preview-container');
                const hasContent = previewContainer && previewContainer.children.length > 0;
                
                if (djangoData.isEditMode && hasContent) {
                    togglePreview();
                }
            });


            function setToday(fieldId) {
    const today = new Date();
    const formattedDate = today.toISOString().split('T')[0];
    document.getElementById(fieldId).value = formattedDate;
}

function showCalendar(fieldId) {
    const input = document.getElementById(fieldId);
    if (input) {
        input.focus();
        input.showPicker ? input.showPicker() : input.click();
    }
}

// Update edit button visibility based on lottery type selection
document.addEventListener('DOMContentLoaded', function() {
    const lotteryTypeSelect = document.getElementById('{{ form.lottery_type.id_for_label }}');
    const editBtn = document.querySelector('.edit-btn');
    
    if (lotteryTypeSelect && editBtn) {
        lotteryTypeSelect.addEventListener('change', function() {
            if (this.value) {
                editBtn.style.display = 'inline-flex';
                editBtn.href = editBtn.href.replace(/\/\d+\/$/, '/' + this.value + '/');
            } else {
                editBtn.style.display = 'none';
            }
        });
    }
});
        </script>
    {% endblock %}